<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.69.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=author content="Mohamed Muhannad"><meta name=keywords content="aws,apigateway,lambda,dynamodb,cloudresumechallenge,javascript,python,dev"><meta name=description content="Phase 3 of #CloudResumeChallenge where I develop a small application to handle a visit counter. This one was a huge learning curve for me and I share how I attempted to complete the task."><meta property="og:title" content="Phase 3: Building a Site Visit Counter with AWS API Gateway / Lambda / DynamoDB"><meta property="og:description" content="Phase 3 of #CloudResumeChallenge where I develop a small application to handle a visit counter. This one was a huge learning curve for me and I share how I attempted to complete the task."><meta property="og:type" content="article"><meta property="og:url" content="https://muhannad0.github.io/post/phase3-build-site-visit-counter-apigateway-lambda-dynamodb-cloudresumechallenge/"><meta property="og:image" content="https://muhannad0.github.io/images/post-images/srvls_aws_serverless_icons.png"><meta property="article:published_time" content="2020-06-05T14:46:58+05:00"><meta property="article:modified_time" content="2020-06-05T14:46:58+05:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://muhannad0.github.io/images/post-images/srvls_aws_serverless_icons.png"><meta name=twitter:title content="Phase 3: Building a Site Visit Counter with AWS API Gateway / Lambda / DynamoDB"><meta name=twitter:description content="Phase 3 of #CloudResumeChallenge where I develop a small application to handle a visit counter. This one was a huge learning curve for me and I share how I attempted to complete the task."><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=https://muhannad0.github.io/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://muhannad0.github.io/css/main.css><link rel=stylesheet type=text/css media=screen href=https://muhannad0.github.io/css/all.css><link rel=stylesheet href=https://muhannad0.github.io/css/katex.min.css crossorigin=anonymous><script defer src=https://muhannad0.github.io/js/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://muhannad0.github.io/js/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body);></script><link rel=stylesheet type=text/css media=screen href=https://muhannad0.github.io/css/css/custom.css><title>Phase 3: Building a Site Visit Counter with AWS API Gateway / Lambda / DynamoDB | Muhannad.0</title></head><body><header><div id=avatar><a href=https://muhannad0.github.io/><img src=/images/avatar.jpg alt=Muhannad.0></a></div><div id=titletext><h2 id=title><a href=https://muhannad0.github.io/>Muhannad.0</a></h2></div><div id=title-description><p id=subtitle>mostly about cloud, automation, IT infra, ops. but wait, there&rsquo;s more&mldr;</p><div id=social><nav><ul><li><a href=https://github.com/muhannad0/><i title=Github class="icons fab fa-github"></i></a></li><li><a href=https://www.linkedin.com/in/muhannad0/><i title=LinkedIn class="icons fab fa-linkedin"></i></a></li><li><a href=https://twitter.com/monde_><i title=Twitter class="icons fab fa-twitter"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/post>All Posts</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li><li><a href=/categories>Categories</a></li></ul></nav></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>05</span>
<span class=rest>Jun 2020</span></div></div><div class=matter><h1 class=title>Phase 3: Building a Site Visit Counter with AWS API Gateway / Lambda / DynamoDB</h1></div></div><div class=markdown><p>In this part of the challenge, we&rsquo;re supposed to build a visit counter feature for our static website.</p><p>Honestly, this may have been the <strong>hardest part of this challenge</strong> so far. My only exposure to software development has been scripting. That is something which is very procedural and once off. But the lack of actual software development background meant I had to really rack my brain until things clicked. In addition to building a Lambda Function using Python, I had to figure out how to put it between API Gateway and DynamoDB. I had never used these services at all and was clueless for a good while.
<img src=/images/post-images/srvls_aws_serverless_icons.png alt="AWS Serverless Trinity"></p><p>When faced with new things, I usually try out the examples in the official documentation to get an idea. AWS has good documentation with guided examples. But sometimes they can be too basic, and only explain just one part of a feature. It&rsquo;s up to you to figure out how it fits into the overall solution. So I went back to basics, and took a beginner bootcamp course on building Serverless applications.</p><h2 id=a-few-words-about-the-serverless-model>A few words about the Serverless model</h2><p>Discovering the &ldquo;Serverless Trinity&rdquo;; API Gateway, Lambda, DynamoDB was very enlightening. The fact that it&rsquo;s so easy to setup runtime environments, a fast and scalable database, full featured API frontend that can connect back to your runtime functions.. It&rsquo;s really impressive.
<img src=/images/post-images/srvls_aws_serverless_service.png alt="Microservices using Serverless"></p><p>This project is my first introduction to the serverless paradigm. It helped me understand how these 3 services are used together.. and the small details which trip you up when trying to actually integrate them. I&rsquo;ll highlight key areas that I think is important to note when starting out with a serverless application.</p><p>I am very amazed that a beginner developer like myself could quickly get an application up and running. And all of that without having to worry about any server configuration. Similar platforms and services are now supported by all major cloud providers. It&rsquo;s really interesting approach to building applications, in terms of value to business.</p><p>Coming from an infra background, where servers are dear to me, I do have mixed feelings about this. Of course, there are servers running in the background, but this level of abstraction and functionality leads me to believe that this would be a preference in the future. I digress a bit, so let&rsquo;s put a pin on it here. I might share some thoughts on it in a post later.</p><h2 id=lessons-learned>Lessons Learned</h2><h3 id=plan-ahead>Plan Ahead</h3><p>As a beginner to software development, I found that it&rsquo;s good to plan out what you&rsquo;re trying to build. It&rsquo;s exciting to start the actual work and get clacking away at the keyboard. But having a plan helps keep you on track and not deviate when trying to code out different parts of the application.</p><p>A diagram is extremely useful.
<img src=/images/post-images/srvls_crc_visit_backend.png alt="Application Sketch Diagram"></p><p>I started out with what data should be saved in DynamoDB.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>website <span style=color:#75715e># url of the website</span>
counter <span style=color:#75715e># visit count</span>
last_updated <span style=color:#75715e># timestamp when counter was last updated</span>
</code></pre></div><p>Next I thought of how the website front-end would access the API to retrieve and update the data. I came up with the scheme below for API Gateway.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/api/visit -&gt; <span style=color:#75715e># sending a POST request will update counter data and return the updated value.</span>
/api/visit/&lt;url; example.com&gt; -&gt; <span style=color:#75715e># sending GET request will fetch recent data.</span>
</code></pre></div><p>Now for the Lambda function which is the glue to both pieces I went and mapped out how it would operate with the database and requests sent from API Gateway.</p><ul><li>Functions to handle the database operations</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># for this part boto3 package for Python is required</span>
-&gt; database connection
-&gt; create table
-&gt; put item
-&gt; get item
-&gt; update item
</code></pre></div><ul><li>Functions to handle the api requests</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>-&gt; what to do if GET method
-&gt; what to do if POST method
-&gt; what to do if neither method
</code></pre></div><h3 id=coding>Coding</h3><ul><li>Using functions to manage common tasks.</li><li>Using <code>try catch</code> methods to handle errors.</li><li>Structured responses, so that front end can utilize them easily.</li><li><strong>Know when to stop tinkering.</strong> I may have already got the code to work, but trying out how someone else on StackOverflow has implemented it would lead me down a rabbit hole. Before I know it, I&rsquo;d be more confused.</li></ul><p>The key takeaway here is that I <strong>need to practice everyday</strong>. Also study more on object-oriented concepts. I feel like I can improve the application more using that approach.</p><h3 id=javascript>Javascript</h3><p>It is an easy language to pick up. But there&rsquo;s still lots more to learn. Things like async, promises and await are going over my head at the moment üòì. More experimenting is needed to understand the concept better.</p><h3 id=dynamodb>DynamoDB</h3><ul><li>Quickest way to setup up a local DynamoDB is using <a href=https://hub.docker.com/r/amazon/dynamodb-local/>Docker</a>.</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker pull docker pull amazon/dynamodb-local
docker run --rm -d -p 8000:8000 --name dynamodblocal docker pull amazon/dynamodb-local
</code></pre></div><p><img src=/images/post-images/srvls_ddb_items.png alt="DynamoDB Table Items"></p><h3 id=lambda>Lambda</h3><ul><li>Understand mixed use of boto3&rsquo;s client vs resource methods. (I found that both options are for low level or high level operations DynamoDB resource. High-level is more suited for data manipulation.)</li><li>Make use of the test events before integrating with API Gateway. This would save lot of time instead of going back and forth between the 2 services</li></ul><p><img src=/images/post-images/srvls_lambda_exec_success.png alt="Lambda Executed Successfulyy"></p><h3 id=api-gateway>API Gateway</h3><ul><li>Use of Lambda Proxy Integration. This means that all requests from the API Gateway will be proxied to the Lambda function. So the function must be able to process them and return appropriate responses. (eg: CORS headers, response codes, messages, validation etc.)</li><li>Got bit confused with the python dict and json types of response when passing from Lambda function to API Gateway.</li></ul><p><img src=/images/post-images/srvls_apigw_get.png alt="Lambda Executed Successfulyy"></p><h3 id=writing-tests>Writing Tests</h3><p>I had only heard of testing code but never saw it in action. This was my first attempt at such a topic. Some Python specific and general testing ideas are:</p><ul><li>Used <a href=https://docs.python.org/3/library/unittest.html>unittest</a>.</li><li>Tests written for Lambda function logic and database operation functions.</li><li>Use of <code>setupclass</code> and <code>tearDownClass</code> to setup a test database and not for all tests (like in <code>setUp</code>).</li><li>There seems to be mixed views on running tests for database operations. At this time, I&rsquo;m testing against a local database. This wouldn&rsquo;t work on a CI pipeline if a test database is missing. People have been recommending using mock tests, so I might need to modify the test code.</li></ul><p><img src=/images/post-images/srvls_running_unittests.png alt="Running Unittest"></p><h2 id=conclusion>Conclusion</h2><p>We really take all these web apps we use daily for granted. From this part of the challenge alone, I realized the huge number of moving parts there are to something that we so easily consume everyday. Kudos to all you software devs! üëè I aspire to join your ranks one of these days.</p><p>Overall, I am so happy and relieved to be able to complete this part. There were times it felt like this is too much work and I&rsquo;d never understand this. But the key here is to <strong>keep at it consistently</strong>. If it&rsquo;s overwhelming, try to <strong>break it down into smaller pieces</strong>. That way you can focus on just that and not think of other parts of the application. Worst case, drop the coding and take a break to reset your mind <em>(have you turned it off and on again?)</em> üòÑ</p><p>Also <strong>practice coding everyday, even a small bit</strong>. That really helps solidify what you have learned and you get more confident in writing code.</p><p><em>Side Note: This would be my 2nd web application I&rsquo;ve written.</em></p><h3 id=references-used>References Used</h3><p><a href="https://www.udemy.com/share/1013NSAkEScF1RTXQ=/">AWS Lambda & Serverless Architecture Bootcamp by Riyaz Sayyad</a></p><p><a href=https://docs.aws.amazon.com/lambda/latest/dg/lambda-python.html>AWS Documentation: Building Lambda functions with Python</a></p><p><a href=https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GettingStarted.Python.html>AWS Documentation: Getting Started Developing with Python and DynamoDB</a></p><p><a href=https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/dynamodb.html>Boto3 Documentation for DynamoDB</a></p><p><a href=https://realpython.com/python-testing/>Getting Started With Testing in Python</a></p></div><div class=tags><div class=taxosfloating_left><p>Categories</p></div><div class=termsfloating_right><p><a href=/categories/blod/>blod</a>
<a href=/categories/guide/>guide</a></div><div class=clearit></div><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/apigateway/>apigateway</a>
<a href=/tags/aws/>aws</a>
<a href=/tags/cloudresumechallenge/>cloudresumechallenge</a>
<a href=/tags/dev/>dev</a>
<a href=/tags/dynamodb/>dynamodb</a>
<a href=/tags/javascript/>javascript</a>
<a href=/tags/lambda/>lambda</a>
<a href=/tags/python/>python</a></div><div class=clearit></div></div></div></main><footer><a href=https://github.com/dataCobra/hugo-vitae>Vitae</a> theme for <a href=https://gohugo.io>Hugo</a>
<script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-166606040-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></footer></body></html>