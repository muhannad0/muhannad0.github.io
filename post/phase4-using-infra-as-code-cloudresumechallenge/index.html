<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.69.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=author content="Mohamed Muhannad"><meta name=keywords content="aws,cloudformation,serverless,framework"><meta name=description content="Phase 4 of #CloudResumeChallenge where I try to deploy to AWS using infra-as-code. During the initial work to develop the resume website, I used the console to set things up. But knowing how to define them in a configuration file and use one or two commands to deploy all of it automatically, that saves a lot of time."><meta property="og:title" content="Phase 4: Using Infra as Code on AWS"><meta property="og:description" content="Phase 4 of #CloudResumeChallenge where I try to deploy to AWS using infra-as-code. During the initial work to develop the resume website, I used the console to set things up. But knowing how to define them in a configuration file and use one or two commands to deploy all of it automatically, that saves a lot of time."><meta property="og:type" content="article"><meta property="og:url" content="https://muhannad0.github.io/post/phase4-using-infra-as-code-cloudresumechallenge/"><meta property="og:image" content="https://muhannad0.github.io/images/post-images/iac_tools.png"><meta property="article:published_time" content="2020-06-12T14:31:06+05:00"><meta property="article:modified_time" content="2020-06-12T14:31:06+05:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://muhannad0.github.io/images/post-images/iac_tools.png"><meta name=twitter:title content="Phase 4: Using Infra as Code on AWS"><meta name=twitter:description content="Phase 4 of #CloudResumeChallenge where I try to deploy to AWS using infra-as-code. During the initial work to develop the resume website, I used the console to set things up. But knowing how to define them in a configuration file and use one or two commands to deploy all of it automatically, that saves a lot of time."><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=https://muhannad0.github.io/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://muhannad0.github.io/css/main.css><link rel=stylesheet type=text/css media=screen href=https://muhannad0.github.io/css/all.css><link rel=stylesheet href=https://muhannad0.github.io/css/katex.min.css crossorigin=anonymous><script defer src=https://muhannad0.github.io/js/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://muhannad0.github.io/js/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body);></script><link rel=stylesheet type=text/css media=screen href=https://muhannad0.github.io/css/css/custom.css><title>Phase 4: Using Infra as Code on AWS | Muhannad.0</title></head><body><header><div id=avatar><a href=https://muhannad0.github.io/><img src=/images/avatar.jpg alt=Muhannad.0></a></div><div id=titletext><h2 id=title><a href=https://muhannad0.github.io/>Muhannad.0</a></h2></div><div id=title-description><p id=subtitle>mostly about cloud, automation, IT infra, ops. but wait, there&rsquo;s more&mldr;</p><div id=social><nav><ul><li><a href=https://github.com/muhannad0/><i title=Github class="icons fab fa-github"></i></a></li><li><a href=https://www.linkedin.com/in/muhannad0/><i title=LinkedIn class="icons fab fa-linkedin"></i></a></li><li><a href=https://twitter.com/monde_><i title=Twitter class="icons fab fa-twitter"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/post>All Posts</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li><li><a href=/categories>Categories</a></li></ul></nav></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>12</span>
<span class=rest>Jun 2020</span></div></div><div class=matter><h1 class=title>Phase 4: Using Infra as Code on AWS</h1></div></div><div class=markdown><p>This part of the challenge was super interesting. We have to define the resources used on AWS for our project in a configuration file. Using a few commands, we can automatically deploy the resources, as defined in our configuration, using tools such as <a href=https://aws.amazon.com/cloudformation/>AWS Cloudformation</a>, <a href=https://aws.amazon.com/serverless/sam/>AWS Serverless Application Model</a> and the open source <a href=https://www.serverless.com/>Serverless Framework</a>.
<img src=/images/post-images/iac_tools.png alt=toolsets></p><p>Coming from an infrastructure background, I understand how time consuming it is to set things up manually. There&rsquo;s a saying where <strong>if you have to do the same thing more than three times, you better automate it</strong>. I try to follow this advice as much as possible.</p><h2 id=back-end-infrastructure>Back end Infrastructure</h2><p>As I was researching on how others have done serverless deployments, I found 2 popular tools; AWS SAM and the Serverless Framework. In both tools, the required components are defined in a YAML file and deployed to AWS as a Cloudformation stack.</p><p>After comparing both, I chose to use the Serverless Framework for this project. The framework does the heavy lifting for you to create these resources on AWS.</p><p>For example, below code snippet shows how we can define a Lambda function along with the API Gateway endpoints.
<img src=/images/post-images/iac_sls_tmpl_snippet.png alt="serverless template snippet"></p><ul><li>It&rsquo;s way <a href=https://www.serverless.com/framework/docs/getting-started/>easier to setup</a>. Just a <code>npm install -g serverless</code> does it. SAM needs a couple of pre-requisites (Docker, SAM CLI).</li><li>The <a href=https://www.serverless.com/framework/docs/providers/aws/>documentation</a> is comprehensive and easy to understand, with plenty of examples.</li><li>It&rsquo;s way easier to deploy a stack. Just a <code>serverless deploy</code> does it, compared to running few commands on sam.
<img src=/images/post-images/iac_sls_deploy.png alt="Deploy Servless Stack"></li><li>Testing your serverless application on the <a href=https://www.serverless.com/framework/docs/providers/aws/cli-reference/invoke-local/>local machine</a> is easy using few plugins. Also, the ability to have different environments on AWS is also a huge advantage when testing.</li><li>Configuration template syntax is very similar. So it would be easy to switch between the 2 if required.</li></ul><h3 id=lessons-learned>Lessons Learned</h3><ul><li>When defining infra-as-code, it is important to keep it flexible. Use variables and don&rsquo;t hard code values into the configuration.</li><li>This approach meant I had to modify the Lambda function to be flexible as well, in the sense that it can identify the resources automatically provisioned by the framework. (For example, the deployed AWS regions, DynamoDB table etc.)</li><li>Using a separate user for deployment with minimal IAM permissions (not be admin for all of your AWS account) that enables the framework to create the necessary resources. AWS CLI allows to configure different profiles that you can switch to when running CLI commands.</li></ul><h2 id=front-end-infrastructure>Front end Infrastructure</h2><p>Although I had setup the static website hosting earlier in the console, I thought of attempting this using Cloudformation templates. This way I could use the same template for another project that might need a static website.
<img src=/images/post-images/iac_cfn_tmplt_snippet.png alt="cfn template snippet"></p><p>We define the resources required as shown in the example above and deploy them using using the AWS CLI command line.
<img src=/images/post-images/iac_cfn_update_stack.png alt="cfn update stack"></p><h3 id=lessons-learned-1>Lessons Learned</h3><ul><li>There are useful intrinsic functions within Cloudformation, like Sub, Split, Join which can help manipulate auto-generated or input values needed for different configurations.</li><li>Need to get more familiar with using change sets, which help identify how your configuration changes are going to impact the existing stack. You can choose to apply those change sets based on the results. This is much better than going straight for the <code>update-stack</code> which might end up in a failed state if you missed something in the configuration.</li></ul><h2 id=conclusion>Conclusion</h2><p>In this task, we got to define the AWS resources needed for our project in a template and use simple commands to deploy them. This has been a huge time saver and also served as documentation for future reference.</p><p>Also using frameworks such as Serverless Framework helps speed up the development work, as now you can focus on the application code, knowing that the framework will take care of ensuring the resources are setup properly.</p><p><img src=/images/post-images/iac_cfn_stacks.png alt="cfn stacks"></p><p>In the next part, we will be checking all of our code in source control (Github) and automating the build, test and deploy steps as part of CI/CD.</p></div><div class=tags><div class=taxosfloating_left><p>Categories</p></div><div class=termsfloating_right><p><a href=/categories/blog/>blog</a>
<a href=/categories/notes/>notes</a></div><div class=clearit></div><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/aws/>aws</a>
<a href=/tags/cloudformation/>cloudformation</a>
<a href=/tags/framework/>framework</a>
<a href=/tags/serverless/>serverless</a></div><div class=clearit></div></div></div></main><footer><a href=https://github.com/dataCobra/hugo-vitae>Vitae</a> theme for <a href=https://gohugo.io>Hugo</a>
<script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-166606040-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></footer></body></html>